# Kitchen Cleanup Notification
- id: kitchen_cleanup_notification
  alias: "Kitchen Cleanup Notification"
  description: "Send notifications when kitchen needs cleaning"
  trigger:
    - platform: state
      entity_id: sensor.kitchen_analysis
      to: "needs_cleaning"
  condition:
    - condition: state
      entity_id: input_boolean.kitchen_monitoring_enabled
      state: "on"
    - condition: state
      entity_id: input_boolean.notifications_enabled
      state: "on"
    # Check 30-minute cooldown period
    - condition: template
      value_template: >
        {% set last_notification = states('input_datetime.last_kitchen_notification') %}
        {% if last_notification == 'unknown' %}
          true
        {% else %}
          {{ (as_timestamp(now()) - as_timestamp(last_notification)) / 60 > states('input_number.notification_cooldown') | int }}
        {% endif %}
  action:
    # Update last notification time
    - action: input_datetime.set_datetime
      target:
        entity_id: input_datetime.last_kitchen_notification
      data:
        datetime: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"
      
    # Send reminder to Liam
    - event: UNotify
      event_data_template:
        message_speak: 'Hey Liam, the kitchen needs some attention when you have a moment'
        message_display: 'Kitchen Needs Cleaning üçΩÔ∏è'
        message: 'Hey, when you''re done in the kitchen, {{ state_attr(''sensor.kitchen_analysis'', ''specific_tasks'') | default(''please tidy up a bit'') | lower }}.'
        priority: normal
        channel: General
        aiprompt: 'no'
        message_target: liam
        tag: kitchen_cleanup

